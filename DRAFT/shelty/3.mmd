flowchart TD
  %% -------- SHELTY WIREFLOW — v3.4.1 (safe labels) --------

  %% Фаза 1: Основное приложение
  A1[Login] -->|успешный вход| B1[Dashboard]
  A1 -->|Регистрация| A2[Sign Up]
  A2 -->|создан аккаунт| B1

  B1 -->|Добавить объект| B2[Property Create or Edit]
  B2 -->|Сохранить| B3[Property Details]
  B1 -->|Открыть объект| B3

  %% Пейволл второй недвижимости
  B1 -->|Создать вторую недвижимость| Paywall2[Переход на платный план]

  %% Вкладки объекта
  B3 --> B31[Expenses]
  B3 --> B32[Meters]
  B3 --> B33[Documents]
  B3 --> B34[Filters and Reports]

  %% Настройки категорий и счетчиков
  B3 --> CatMgr[Настройка категорий и счетчиков]

  %% Expenses
  B31 -->|Добавить| B31a[Add Expense]
  B31 -->|Открыть| B31b[Expense Details]
  B31 --> Bills[Квитанции]
  B31 --> Receipts[Чеки]
  Bills --> BillAttach[Файлы строки реквизиты теги]
  Receipts --> RecAttach[Файлы и дата оплаты]

  %% Meters
  B32 -->|Добавить показание| C3a[Add Reading]
  B32 --> PhotoReadings[Фото показания]
  B32 --> ReverseReadings[Обратный ввод истории]

  %% Documents
  B33 --> DocFiles[Несколько файлов к одному документу]

  %% Filters
  B34 --> AdvFilters[Объекты категория даты сумма теги поиск]

  %% Фаза 2: Планирование
  D1[Payments Calendar] -->|Клик по событию| B31b
  D1 --> Planned[Запланированные]
  D1 --> Recur[Повторяющиеся]
  D1 --> Done[Совершенные]
  Recur --> StopPlan[Остановить расписание]
  Planned --> CloseWithActual[Закрыть с фактической суммой]

  %% Фаза 3: Аналитика и профиль
  D2[Statistics] -->|Экспорт платно| E3[Billing]
  D2 --> CustomReports[Кастомные отчеты платно]

  E1[Profile] --> E2[Notifications]
  E1 --> E3
  E1 --> E4[Export and Import]
  E1 --> E5[Archive]
  E1 --> E6[Security]
  E1 --> E7[Email Integration]
  E1 --> E8[Help and Support]
  E1 --> Sharing[Шаринг объектов]
  E1 --> Quotas[Лимиты и квоты файлов]
  E1 --> ThemeToggle[Светлая темная тема]
  E1 --> Mascot[Маскот и поощрения]

  %% Действия на уровне объекта
  B3 --> ObjArchive[Архивация объекта]
  B3 --> ObjDelete[Удаление объекта]
  B3 --> ObjNotifs[Уведомления по объекту]

  %% Приходы
  B1 --> Incomes[Приходы аренда страховка суд]

  %% Фаза 4: Монетизация и оффлайн
  E1 --> Offline[Оффлайн кэш]
  E3 --> Plans[Лимиты объекты объем размер]
  E4 --> CSVPDF[Экспорт CSV и PDF платно]
  E4 --> ImportData[Импорт данных]

  %% Фаза 5: Хранилища шифрование интеграции
  B31 --> TxArchive[Архив транзакций опциональное удаление файлов]
  E7 --> Mailbox[Уникальный почтовый ящик авто разбор]
  E7 --> DriveSync[Google Drive синхронизация платно]
  E6 --> Vaults[Приватные хранилища импорт экспорт]
  E6 --> KeyMgmt[Генерация ключей UMK и KID на клиенте]

  %% Системные
  Z1[Error 404 Упс дом не найден]

  %% Нижнее меню — пунктиром
  B1 -.->|Дом| B1
  B1 -.->|Расходы| B31
  B1 -.->|Календарь| D1
  B1 -.->|Отчеты| D2
  B1 -.->|Профиль| E1

  %% Ошибки — пунктиром
  A1 -.->|Ошибка авторизации| Z1
  A2 -.->|Ошибка регистрации| Z1
  B3 -.->|Недоступен объект| Z1

  %% Классы (цвета фаз)
  classDef phase1 fill:#0d1b2a,stroke:#3ea6ff,color:#e6f1ff,stroke-width:1px;
  classDef phase2 fill:#112b1a,stroke:#4caf50,color:#eafff2,stroke-width:1px;
  classDef phase3 fill:#1e1030,stroke:#b26adb,color:#f3eaff,stroke-width:1px;
  classDef phase4 fill:#2b0f10,stroke:#ff6b6b,color:#ffecec,stroke-width:1px;
  classDef phase5 fill:#1f2430,stroke:#9aa4b2,color:#e8edf4,stroke-width:1px;

  %% Назначение классов
  class A1,A2,B1,B2,B3,B31,B31a,B31b,B32,C3a,PhotoReadings,ReverseReadings,B33,DocFiles,B34,AdvFilters,Bills,Receipts,BillAttach,RecAttach,CatMgr,Incomes,ObjArchive,ObjDelete,ObjNotifs phase1;
  class D1,Planned,Recur,Done,StopPlan,CloseWithActual phase2;
  class D2,E1,E2,E3,E4,E5,E6,E7,E8,Sharing,Quotas,ThemeToggle,Mascot,CustomReports phase3;
  class Paywall2,Offline,Plans,CSVPDF,ImportData,DriveSync,TxArchive,Vaults,KeyMgmt,Mailbox phase4;
  class Z1 phase5;
